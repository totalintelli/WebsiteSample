<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <style>
      .google-visualization-table-td {
        color: white !important;
        background-color: #333333 !important;
        /* border: black !important; */
        text-align: right;
      }
      body {
        background-color: #333333;
      }
      .google-visualization-table-th {
        color: white;
        background-color: #191919 !important;
        fill-opacity: 1 !important;
        /* border: 3a3a3a !important; */
      }
      .google-visualization-table-div-page {
        color: white;
        background-color: #242424 !important;
        fill-opacity: 1 !important;
        text-align: center !important;
        height: 30px;
        padding: 5px 5px !important;
      }
      .goog-custom-button-outer-box {
        font-size: 15px !important;
      }
      .google-visualization-table-page-number {
        height: 17px;
        font-size: 15px !important;
      }
    </style>
  </head>

  <body>
    <table></table>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="./js/loader.js"></script>
    <div id="tableContent">
      <div>
        <button id="export" class="ui-button ui-widget ui-corner-all">
          <span class="ui-icon ui-icon-circle-triangle-s"></span
          ><span>&nbsp;Download CSV</span>
        </button>
      </div>
      <p>
        <div id="table_div"></div>
      </p>
    </div>
    <script type="text/javascript">
      // Load the Visualization API and the corechart package.
      google.charts.load("current", { packages: ["table"] });
      
      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(draw);

      function draw() {
        drawDayTable();
        const ths = document.querySelectorAll("th");
        ths.forEach(function(th) {
          th.classList.remove("gradient");
        });
        const table_div = document.getElementById("table_div");
        const page = table_div.childNodes[0].childNodes[1];
        page.classList.remove("gradient");
      }

      function formatDate(date) {
        var d = new Date(date),
          month = "" + (d.getMonth() + 1),
          day = "" + d.getDate(),
          year = d.getFullYear();

        if (month.length < 2) month = "0" + month;
        if (day.length < 2) day = "0" + day;

        return [year, month, day].join("-");
      }

      const today = formatDate(new Date());
      const dataset = [
        [
          "1",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "2",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "3",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "4",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "5",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "6",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "7",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "8",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "9",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "10",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "11",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "12",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "13",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "14",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "15",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "16",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          null,
          null,
          "누계/합계",
          100000.1,
          100000,
          100000,
          100000,
          100000,
          100000,
          100000,
          100000,
          100000,
          100000,
          100000
        ],
        [
          "17",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "18",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "19",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "20",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ],
        [
          "21",
          today,
          "5:00",
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0,
          130.0
        ]
      ];

      function drawDayTable() {
        var data = new google.visualization.DataTable();

        // 표의 열을 생성한다.
        data.addColumn("string", "구분");
        data.addColumn("string", "일자");
        data.addColumn("string", "시간");
        data.addColumn("number", "INV-1(kWh)");
        data.addColumn("number", "INV-2(kWh)");
        data.addColumn("number", "INV-3(kWh)");
        data.addColumn("number", "INV-4(kWh)");
        data.addColumn("number", "INV-5(kWh)");
        data.addColumn("number", "전체 발전량(kWh)");
        data.addColumn("number", "발전시간(h)");
        data.addColumn("number", "경사일사량(W/㎡)");
        data.addColumn("number", "수평일사량(W/㎡)");
        data.addColumn("number", "모듈온도(℃)");
        data.addColumn("number", "대기온도(℃)");

        // 표의 행을 생성한다.
        data.addRows(dataset);

        // 표의 열 스타일을 설정한다.
        for (let i = 0; i < 22; i++) {
          data.setProperty(i, 0, "style", "width: 5px;text-align: center;");
          data.setProperty(i, 1, "style", "width: 100px;text-align: center;");
          data.setProperty(i, 2, "style", "width: 70px;text-align: center;");
        }

        var table = new google.visualization.Table(
          document.getElementById("table_div")
        );

        table.draw(data, {
          width: "100%",
          height: "100%",
          page: "enable",
          pageSize: 17,
          pagingSymbols: {
            prev: "◀",
            next: "▶"
          },
          pagingButtonsConfiguration: "auto",
          allowHtml: true
        });

        return data;
      }

      $("#export").on("click", function() {
        var browserIsIE;
        var csvColumns;
        var csvContent;
        var downloadLink;
        var fileName;
        var tableData = drawDayTable();
        // build column headings
        csvColumns = "";
        for (var i = 0; i < tableData.getNumberOfColumns(); i++) {
          csvColumns += tableData.getColumnLabel(i);
          if (i < tableData.getNumberOfColumns() - 1) {
            csvColumns += ",";
          }
        }
        csvColumns += "\n";

        // build data rows
        csvContent =
          csvColumns + google.visualization.dataTableToCsv(tableData);

        // download file
        browserIsIE = false || !!document.documentMode;
        fileName = "data.csv";
        if (browserIsIE) {
          window.navigator.msSaveBlob(
            new Blob([csvContent], { type: "data:text/csv" }),
            fileName
          );
        } else {
          downloadLink = document.createElement("a");
          downloadLink.href =
            "data:application/csv;charset=utf-8,\uFEFF" + encodeURI(csvContent);
          downloadLink.download = fileName;
          raiseEvent(downloadLink, "click");
          downloadLink = null;
        }
      });

      // 엑셀 버튼 클릭 이벤트를 실행한다.
      function raiseEvent(element, eventType) {
        var eventRaised;
        if (document.createEvent) {
          eventRaised = document.createEvent("MouseEvents");
          eventRaised.initEvent(eventType, true, false);
          element.dispatchEvent(eventRaised);
        } else if (document.createEventObject) {
          eventRaised = document.createEventObject();
          element.fireEvent("on" + eventType, eventRaised);
        }
      }

      
    </script>
  </body>
</html>
